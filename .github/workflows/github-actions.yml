name: "Fetch weather API updates and cache results"

on:
  push:
    branches:
      - master
#  schedule:
#    - cron: "*/35 * * * *"
#    - cron: "*/30 0-1,4-23 * * *" # Every 30 minutes, at 12:00 AM through 01:59 AM and 04:00 AM through 11:59 PM > 294 API calls for 7 regions
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  # Build job
#  build:
  # <Not provided for brevity>
  # At a minimum this job should upload artifacts using actions/upload-pages-artifact

#  deploy:
#    environment:
#      name: "github-pages"
#      url: ${{ steps.deployment.outputs.page_url }}
#
#    runs-on: ubuntu-latest
#
#    needs: build
#
#    steps:
#      - name: "Checkout"
#        uses: actions/checkout@v3
#
#      - name: "Setup Pages"
#        uses: actions/configure-pages@v1
#
#      - name: "Update weather data"
#        shell: bash
#        run: |
#          curl -X POST -d {} https://weerlive.nl/api/json-data-10min.php?key=${{ secrets.API_KEY }}&locatie=Amsterdam > ${{ runner.temp }}/weather_data.json
#
#      - name: "Upload artifact"
#        uses: actions/upload-pages-artifact@v1
#        with:
#          # Upload entire repository
#          path: ${{ runner.temp }}/weather_data.json
#
#      - name: "Deploy to GitHub Pages"
#        id: deployment
#        uses: actions/deploy-pages@v1

    deploy:
      environment:
        name: github-pages
        url: ${{ steps.deployment.outputs.page_url }}
      runs-on: ubuntu-latest
      steps:
        - name: Checkout
          uses: actions/checkout@v3
        - name: Setup Pages
          uses: actions/configure-pages@v1
        - name: Upload artifact
          uses: actions/upload-pages-artifact@v1
          with:
            # Upload entire repository
            path: './api/weather_data.json'
        - name: Deploy to GitHub Pages
          id: deployment
          uses: actions/deploy-pages@main